<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Только для Юзера</title>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/256/5020/5020658.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet"> <!-- ПОДКЛЮЧАЕМ ОБЩИЕ СТИЛИ --> </head>
<body>
<div class="container">
    <!-- 1 ряд сетки страницы -->
    <div class="row p-3" style="background-color: #424242; color: white;">
        <!-- левая колонка 1 ряда -->
        <div class="col text-start">
            <!-- Юзаю JavaScript для отображения email и ролей -->
            <b id="user-email">...</b> <!-- вместо ... вставится email -->
            <span id="user-roles">...</span> <!-- вместо ... вставятся роли -->
        </div>
        <!-- закрыл левую колонку 1 ряда -->
        <!-- правая колонка первого ряда -->
        <div class="col text-end">
            <a href="/logout" class="text-decoration-none opacity-50" style="color: white;">Логаут</a>
        </div>
    </div>
    <!-- закрыл 1 ряд сетки страницы -->

    <!-- 2 ряд сетки страницы -->
    <div class="row">
        <!-- левая колонка 2 ряда страницы -->
        <div class="col-2 p-0" style="background-color: #fff;">
            <a href="/start" class="text-decoration-none">
                <button class="btn btn-other w-100 text-start mt-3">Start page</button>
            </a>
            <a href="/admin" class="text-decoration-none">
                <button class="btn btn-other w-100 text-start mt-3">Admin page</button>
            </a>
            <br>
            <a href="/user" class="text-decoration-none">
                <button class="btn btn-current w-100 text-start">User page</button>
            </a>
        </div>
        <!-- закрыл левую колонку 2 ряда страницы -->
        <!-- правая колонка 2 ряда страницы -->
        <div class="col  p-3">
            <!-- 1 колонка 2 ряда страницы, содержащая таблицу -->
            <h3><strong>User information page</strong></h3>
            <div class="container mt-5">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="table1" role="tabpanel" aria-labelledby="table1-tab">
                        <table class="table table mb-0 table-striped table-bordered mt-3">
                            <tbody>
                            <tr>
                                <th>Ваши регистрационные данные из Principal</th>
                            </tr>
                            <tr>
                                <td>
                                    <table class="table table mb-0 table-striped table-hover ">
                                        <thead>
                                        <tr>
                                            <th scope="col">ID</th>
                                            <th scope="col">Имя</th>
                                            <th scope="col">Возраст</th>
                                            <th scope="col">Email</th>
                                            <th scope="col">Роли</th>
                                        </tr>
                                        </thead>
                                        <tbody id="currentUserTable">
                                        </tbody>
                                    </table>
                                    <!-- конец Users table таблицы  -->
                                </td>
                            </tr>
                            </tbody>
                            <!-- конец All users таблицы для вложения Users table  -->
                        </table>
                    </div>
                </div>
                <!-- закрыл правую широкую колонку страницы -->
            </div>
        </div>
    </div>
    <!-- закрыл 2 ряд сетки страницы -->
</div>
<!-- закрыл область деления страницы сеткой -->

<!-- Скрипт для заполнения шапки и таблицы: -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Загрузка данных текущего пользователя при загрузке страницы
        loadCurrentUser();

        // Функция загрузки данных текущего пользователя и заполения шапки
        async function loadCurrentUser() {
            try {
                const response = await fetch('/api/user/current');
                const userDTO = await response.json();
                document.getElementById('user-email').textContent = userDTO.email;
                document.getElementById('user-roles').textContent = 'with roles: ' +
                    userDTO.roles.map(role => role.name.replace("ROLE_", "")).join(', ');
                const tbody = document.getElementById('currentUserTable');
                tbody.innerHTML = '';
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${userDTO.id}</td>
                <td>${userDTO.name}</td>
                <td>${userDTO.age}</td>
                <td>${userDTO.email}</td>
                <td>${userDTO.roles.map(role => role.name.replace("ROLE_", "")).join(', ')}</td>
            `;
                tbody.appendChild(row);
            } catch (error) {
                console.error('Ошибка загрузки текущего пользователя:', error);
            }
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>